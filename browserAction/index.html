<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Mentions+ Settings</title>
    <link href="style.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>GitHub Mentions+</h1>
        <p class="subtitle">Enhance GitHub @mention autocomplete</p>
      </header>

      <main>
        <section class="settings-section">
          <h2>Data Source Configuration</h2>
          
          <div class="form-group">
            <label>Data Source</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="dataSource" value="gui" checked/>
                <span class="radio-label">Local</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="dataSource" value="direct" />
                <span class="radio-label">Local(JSON)</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="dataSource" value="endpoint" />
                <span class="radio-label">HTTP Endpoint</span>
              </label>
            </div>
          </div>

          <!-- Endpoint Configuration -->
          <div id="endpointSection" class="data-source-section">
            <h3>Endpoint Configuration</h3>
            <div class="form-group">
              <label for="endpointUrl">Endpoint URL</label>
              <input 
                type="url" 
                id="endpointUrl" 
                placeholder="https://your-endpoint.com/users.json"
                class="form-control"
              />
              <small class="help-text">
                Your endpoint must return a JSON array of user objects with <code>username</code>, <code>name</code> and <code>avatar</code> fields.
              </small>
            </div>

            <div class="form-group">
              <button id="testEndpoint" class="btn btn-secondary">
                Test Endpoint
              </button>
              <button id="refreshUsers" class="btn btn-primary">
                Refresh User List
              </button>
            </div>
          </div>

          <!-- Direct JSON Input -->
          <div id="directJsonSection" class="data-source-section hidden">
            <h3>Direct JSON Input</h3>
            <div class="form-group">
              <label for="directJsonData">User Data (JSON)</label>
              <textarea 
                id="directJsonData" 
                placeholder='[
  {
    "username": "john-doe",
    "name": "John Doe",
    "avatar": "https://example.com/avatar.jpg"
  },
  {
    "username": "jane-smith",
    "name": "Jane Smith"
  }
]'
                class="form-control json-textarea"
                rows="12"
              ></textarea>
              <small class="help-text">
                Enter JSON array of user objects. Each user must have <code>username</code> and <code>name</code> fields. <code>avatar</code> is optional.
              </small>
            </div>
            
            <div class="form-group">
              <button id="validateJson" class="btn btn-secondary">
                Validate JSON
              </button>
              <button id="loadDirectUsers" class="btn btn-primary">
                Load Users
              </button>
            </div>
          </div>

          <!-- GUI Settings -->
          <div id="guiJsonSection" class="data-source-section hidden">
            <h3>Local User Management</h3>
            
            <!-- GUI Table for User Data -->
            <div class="form-group">
              <label>User Data</label>
              <div class="user-table-container">
                <table class="user-table" id="userTable">
                  <thead>
                    <tr>
                      <th>Username <span class="required">*</span></th>
                      <th>Name</th>
                      <th>Profile</th>
                      <th style="width: 60px;">Action</th>
                    </tr>
                  </thead>
                  <tbody id="userTableBody">
                    <!-- Rows will be added dynamically -->
                  </tbody>
                </table>
              </div>
              <small class="help-text">
                <code>username</code> is required. Click "Add Row" to add more users.
              </small>
            </div>
            
            <div class="form-group">
              <button id="addUserRow" class="btn btn-secondary">
                + Add Row
              </button>
              <button id="loadGuiUsers" class="btn btn-primary">
                Load Users
              </button>
            </div>
          </div>
          <div id="endpointStatus" class="status-indicator hidden">
            <div class="status-icon"></div>
            <span class="status-text"></span>
          </div>
        </section>

        <section class="settings-section">
          <h2>! Commands (Max 10)</h2>
          
          <div class="form-group">
            <p class="subtitle">Create custom commands that insert markdown snippets into GitHub comments.</p>
          </div>
          
          <div id="commandsGrid" class="commands-grid">
            <!-- Command cards will be added here -->
          </div>
          
          <div class="form-group" style="text-align: center; margin-top: 20px;">
            <button id="addCommand" class="btn btn-primary">
              + Add New Command
            </button>
            <span id="commandCount" class="command-count">0/10</span>
          </div>
          
          <details class="help-details">
            <summary>How to use commands</summary>
            <div class="help-content">
              <p><strong>Usage:</strong> Type <code>!commandname</code> in any GitHub comment box and press Enter</p>
              
              <p><strong>Examples:</strong></p>
              <pre><code>!lgtm ‚Üí ![LGTM](https://media.giphy.com/media/XreQmk7ETCak0/giphy.gif)

!checklist ‚Üí 
- [ ] Review completed
- [ ] Tests passing  
- [ ] Ready to merge

!approved ‚Üí ‚úÖ **Approved!** Ready for merge.</code></pre>
              
              <p><strong>Variables you can use:</strong></p>
              <ul>
                <li><code>${timestamp}</code> - Current ISO timestamp</li>
                <li><code>${date}</code> - Current date</li>  
                <li><code>${time}</code> - Current time</li>
              </ul>
            </div>
          </details>
        </section>

        <section class="settings-section">
          <h2>Extension Status</h2>
          
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">Extension:</span>
              <span id="extensionStatus" class="status-value">Loading...</span>
            </div>
            
            <div class="status-item">
              <span class="status-label">Data Source:</span>
              <span id="dataSourceStatus" class="status-value">Loading...</span>
            </div>
            
            <div class="status-item">
              <span class="status-label">Cached Users:</span>
              <span id="cachedUsersCount" class="status-value">Loading...</span>
            </div>
            
            <div class="status-item">
              <span class="status-label">Cache Status:</span>
              <span id="cacheStatus" class="status-value">Loading...</span>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <button id="saveSettings" class="btn btn-primary btn-full">
          Save Settings
        </button>
      </footer>
    </div>

    <!-- Command Editor Modal -->
    <div id="commandModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Add Command</h3>
          <button id="modalClose" class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="commandName">Command Name</label>
            <input type="text" id="commandName" class="form-control command-name-input" placeholder="lgtm">
            <small class="help-text">Use only letters, numbers, hyphens, and underscores</small>
          </div>
          <div class="form-group">
            <label for="commandEmoji">Command Icon (Optional)</label>
            <div class="emoji-selector">
              <input type="text" id="commandEmoji" class="form-control emoji-input" placeholder="Click to select emoji or leave empty" readonly>
              <button type="button" id="emojiPickerBtn" class="btn btn-secondary emoji-picker-btn">üìù</button>
            </div>
            <div id="emojiPicker" class="emoji-picker hidden">
              <div class="emoji-categories">
                <button type="button" class="emoji-category active" data-category="recent">‚è∞</button>
                <button type="button" class="emoji-category" data-category="smileys">üòÄ</button>
                <button type="button" class="emoji-category" data-category="objects">üìù</button>
                <button type="button" class="emoji-category" data-category="symbols">‚ö°</button>
              </div>
              <div class="emoji-grid" id="emojiGrid">
                <!-- Emojis will be populated here -->
              </div>
              <button type="button" id="clearEmoji" class="btn btn-secondary btn-mini">Clear</button>
            </div>
            <small class="help-text">Choose an emoji to represent your command in the dropdown</small>
          </div>
          <div class="form-group">
            <label for="commandContent">Command Content</label>
            <textarea id="commandContent" class="form-control command-content" rows="8" placeholder="üöÄ Ready for review!

Updated: ${timestamp}

Available variables: ${timestamp}, ${date}, ${time}"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="modalCancel" class="btn btn-secondary">Cancel</button>
          <button id="modalSave" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>

    <script src="../utils/storage.js"></script>
    <script src="script.js"></script>
  </body>
</html>
